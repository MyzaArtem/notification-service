# Notification Service ЮНИВУЗ-3

## Видение

Notification Service (NS) представляет собой подключаемый сервис на стороне личного кабинета, который позволяет централизованно получать и отображать уведомления от других сервисов ЮНИВУЗ-3 для текущего пользователя. На главной странице личного кабинета (работника и обучающегося)  справа от имени текущего пользователя появляется иконка "уведомления", на которой в виде баджа (badge https://www.telerik.com/kendo-angular-ui/components/indicators/badge/) отображается количество непрочитанных уведомлений. При клике на иконку - открытие окна просмотра всех уведомлений (без перехода на отдельную страницу). 

## Архитектура решения, функциональные требования

### FrontEnd

Пользовательский интерфейс NS является частью приложений lk-host и lk-student.

- приложение должно обеспечивать связь с backend в реальном времени для получения уведомлений в рельном времени (SignalR или аналог)
- обновление баджа на иконке "уведомления" в реальном времени (SignalR или аналог)
- При получении нового уведомления, появляется полупрозрачное всплывающее окно с текстом (ограничить количеством символов) уведомления, которое исчезает спустя указанное время (из настроек). 
- при клике на всплывающее окно должен происходить переход в список всех уведомлений (страница сайта не меняется)
- список уведомлений пользователя должен подгружаться с бесконечной прокруткой (https://www.telerik.com/kendo-angular-ui/components/listview/scroll-modes/#toc-endless-scrolling)
- в списке уведомлений отмечены прочитанные и непрочитанные уведомления. 
- уведомление считается "прочитанным", через заданное в настройках время при активном окне уведомлений
- в списке уведомлений доступны фильтры по категории уведомления
- список уведомлений  отсортирован по времени получения
- доступна кнопка удаления уведомления
- все ссылки в уведомлении должны открываться в новой вкладке

### Backend

Сервис поиска представляет собой микросервис с несколькими точками взаимодействия:

- Пользовательская точка входа: метод, который принимает в качестве параметра номер и размер запрошенной страницы, категорию уведомлений,  возвращает список уведомлений пользователя с учетом запрошенного размера и номера страницы. 
- Пользовательская точка входа: метод по SignalR отдает новые уведомления пользователя
- Пользовательская точка входа: метод по SignalR отдает количество непрочитанных уведомлений пользователя

Получение уведомлений из других сервисов:

- NS взаимодействует с другими сервисами через RabbitMQ
- NS подписывается на очередь сообщений, остальные сервисы отправляют уведомления в данную очередь
- NS подписывается на очередь сообщений удаления уведомлений, остальные сервисы отправляют информацию об уведомлениях, которые надо удалить (используется имя сервиса + ID)



## Кейсы использования

1) В сервисе Новости и объявления добавляется объявление для сотрудника Петров И.И. Данные по данному уведомлению (кратное описание и заголовок) отправляются в соответствующую очередь для NS. 

   1) Если пользователь Петров И.И в настоящий момент работает в личном кабинете, ему отображается уведомление о новом объявлении, по ссылке из уведомления он в новой вкладке открывает объявление
   2) Если пользователь Петров И.И в настоящий момент не работает в личном кабинете, при следующем входе в ЛК он увидит бадж на иконке уведомлений о количестве непрочитанных уведомлений, кликнув по нему, перейдет к списку уведомлений

   

## Условия/порядок внедрения

При запуске сервиса, он должен автоматически создавать очереди для получения уведомлений через RabbitMQ

Каждый сервис при отправке уведомления указывает категорию уведомления (соответствует наименованию сервиса)

Все сервисы сами решают, какие данные передавать для NS

В любой момент времени без необходимости доработок к NS можно подключить любой другой сервис